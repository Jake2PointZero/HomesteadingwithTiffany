<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Orders</title>
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 10px;
      }

      nav {
        text-align: center;
        margin-bottom: 20px;
      }

      nav a {
        margin: 0 5px;
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
      }

      /* Table for desktop */
      .cart-table {
        width: 100%;
        border-collapse: collapse;
      }

      .cart-table th,
      .cart-table td {
        padding: 6px 10px;
        border: 1px solid #ccc;
        text-align: center;
      }

      .cart-table th {
        background-color: #ff7f50;
        color: white;
      }

      /* Card layout for mobile */
      @media (max-width: 768px) {
        .cart-table,
        .cart-table thead,
        .cart-table tbody,
        .cart-table th,
        .cart-table td,
        .cart-table tr {
          display: block;
        }

        .cart-table thead tr {
          display: none; /* hide table headers */
        }

        .cart-table tr {
          margin-bottom: 15px;
          border: 1px solid #ccc;
          border-radius: 8px;
          padding: 10px;
        }

        .cart-table td {
          text-align: left;
          padding: 6px 10px;
          border: none;
          position: relative;
          padding-left: 50%;
        }

        .cart-table td::before {
          position: absolute;
          left: 10px;
          width: 45%;
          white-space: nowrap;
          font-weight: bold;
        }

        .cart-table td:nth-of-type(1)::before {
          content: "ID";
        }
        .cart-table td:nth-of-type(2)::before {
          content: "Customer";
        }
        .cart-table td:nth-of-type(3)::before {
          content: "Email";
        }
        .cart-table td:nth-of-type(4)::before {
          content: "Address";
        }
        .cart-table td:nth-of-type(5)::before {
          content: "Total";
        }
        .cart-table td:nth-of-type(6)::before {
          content: "Date";
        }
        .cart-table td:nth-of-type(7)::before {
          content: "Items";
        }
      }
    </style>
  </head>
  <body>
    <script>
      if (localStorage.getItem("isAdmin") !== "true") {
        window.location.href = "admin.html";
      }
    </script>

    <h1>All Orders</h1>
    <nav>
      <a href="admindashboard.html">Admin Dashboard</a> |
      <a href="addproduct.html">Add Product</a> |
      <a href="orders.html">View Orders</a>
    </nav>

    <table class="cart-table" id="ordersTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Customer</th>
          <th>Email</th>
          <th>Address</th>
          <th>Total</th>
          <th>Date</th>
          <th>Items</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      fetch("/api/orders")
        .then((res) => res.json())
        .then((orders) => {
          const tbody = document.querySelector("#ordersTable tbody");
          orders.forEach((order) => {
            const tr = document.createElement("tr");

            const orderId = order._id.slice(0, 8);
            const itemsList = order.items
              .map((i) => `${i.name} x ${i.quantity}`)
              .join(", ");

            tr.innerHTML = `
              <td>${orderId}</td>
              <td>${order.customerName}</td>
              <td>${order.customerEmail}</td>
              <td>${order.address}</td>
              <td>$${order.total.toFixed(2)}</td>
              <td>${new Date(order.createdAt).toLocaleString()}</td>
              <td>${itemsList}</td>
            `;
            tbody.appendChild(tr);
          });
        })
        .catch((err) => console.error("Error fetching orders:", err));
    </script>
  </body>
</html>
