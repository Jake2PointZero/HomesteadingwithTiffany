<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <h1>Checkout</h1>

    <div class="cart-summary" id="cartSummary">
      <h3>Your Cart:</h3>
      <ul id="cartItems"></ul>
      <p>Total: $<span id="cartTotal">0.00</span></p>
    </div>

    <form id="checkoutForm">
      <input
        type="text"
        id="customerName"
        placeholder="Full Name"
        required
        autocomplete="name"
      />
      <input
        type="email"
        id="customerEmail"
        placeholder="Email"
        required
        autocomplete="email"
      />
      <input
        type="text"
        id="customerStreet"
        placeholder="Street Address"
        required
        autocomplete="street-address"
      />
      <input
        type="text"
        id="customerCity"
        placeholder="City"
        required
        autocomplete="address-level2"
      />
      <input
        type="text"
        id="customerState"
        placeholder="State / Province"
        required
        autocomplete="address-level1"
      />
      <input
        type="text"
        id="customerZip"
        placeholder="ZIP / Postal Code"
        required
        autocomplete="postal-code"
      />
      <button type="submit">Place Order</button>
    </form>

    <script>
      const cart = JSON.parse(localStorage.getItem("checkoutCart")) || [];
      const cartItemsEl = document.getElementById("cartItems");
      const cartTotalEl = document.getElementById("cartTotal");

      // Display cart items
      let total = 0;
      cart.forEach((item) => {
        const li = document.createElement("li");
        li.textContent = `${item.name} x ${item.quantity} - $${(
          item.price * item.quantity
        ).toFixed(2)}`;
        cartItemsEl.appendChild(li);
        total += item.price * item.quantity;
      });
      cartTotalEl.textContent = total.toFixed(2);

      // Handle form submission
      document
        .getElementById("checkoutForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          if (cart.length === 0) {
            alert("Your cart is empty!");
            return;
          }

          const orderData = {
            customerName: document.getElementById("customerName").value,
            customerEmail: document.getElementById("customerEmail").value,
            customerStreet: document.getElementById("customerStreet").value,
            customerCity: document.getElementById("customerCity").value,
            customerState: document.getElementById("customerState").value,
            customerZip: document.getElementById("customerZip").value,
            items: cart,
            total: total,
          };

          // Correct URL for orders
          fetch("https://homesteadingwithtiffany.onrender.com/api/orders", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(orderData),
          })
            .then((res) => res.json())
            .then((data) => {
              alert(data.message || "Order placed successfully!");
              localStorage.removeItem("cart");
              localStorage.removeItem("checkoutCart");
              window.location.href = "shop.html";
            })
            .catch((err) => {
              console.error("Error placing order:", err);
              alert("There was an error placing your order. Please try again.");
            });
        });
    </script>
    <!-- Bottom Navbar -->
    <nav class="bottom-nav">
      <a href="shop.html">Shop</a>
      <a href="cart.html">Cart</a>
      <a href="checkout.html">Checkout</a>
      <a href="admin.html" id="adminLink">Admin</a>
    </nav>
  </body>
</html>
